<!DOCTYPE html>
<html>
  <head>
    <title><%= site.name%></title>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="<%=site.description%>">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="format-detection" content="telephone=no">

    <%# redirection script for desktop -> mobile to capture GA/referrer info. This must be at the top of the page %>
    <% unless current_member %>
      <%= javascript_include_tag "//s.wldcdn.net/assets/template/premium/scripts/pageswitch.min.js"%>
    <% end %>

    <%= apple_mobile_web_app_meta_tags%>
    <%= apple_touch_icon_link_tags%>
    <%= stylesheet_link_tag%>

    <%# use local copy of jQuery for development mode. %>
    <% if Rails.env.development? %>
      <%= javascript_include_tag "jquery.js"%>
    <% else %>
      <%= javascript_include_tag "//ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"%>
    <% end %>

    <%= javascript_include_tag "application"%>
    <%= csrf_meta_tags%>
  </head>

  <body class="home index">
    <%= yield :top%>

    <header id="page">
      <h1><%= link_to site.name, root_path%></h1>
      <nav>
        <ul>
          <%= yield :actions%>
        </ul>
      </nav>
    </header>
    <div id="column">
      <% flash.each do |key, value| %>
        <div class="flash <%=key%>"><%= value.html_safe%></div>
      <% end %>

      <section id="content">
        <%= yield%>
      </section>
    <div>

    <%# WLD Referral tracking %>
    <script type="text/javascript">
      document.write(unescape("%3Cscript src='/assets/generic/scripts/referral.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var wld_trackingVars = wld_getUrlVars();
      if(wld_trackingVars.length){document.write(unescape("%3Cscript src='/api/tracking/?site=#{site.id}&"+wld_trackingVars+"' type='text/javascript'%3E%3C/script%3E"));}
    </script>

    <% if Rails.env.production? %>
      <% if site.sitetagger_code.present? %>
        <%= raw site.sitetagger_code%>
      <% end %>

      <%# Google Analytics Tracking %>
      <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-3965813-35'], ['_setDomainName', '.#{site.root_domain}'], ['_setAllowLinker', true], ['_trackPageview'#{@ga_pageview_url ? ", '" + @ga_pageview_url + "'" : ""}], ['_trackPageLoadTime']);
        _gaq.push(['blended._setAccount', 'UA-3965813-33'], ['blended._setDomainName', 'none'], ['blended._trackPageview'#{@ga_pageview_url ? ", '" + @ga_pageview_url + "'" : ""}], ['blended._trackPageLoadTime']);
        _gaq.push(['partner._setAccount', '#{site.ga_code}'], ['partner._setDomainName', '.#{site.root_domain}'], ['partner._setAllowLinker', true], ['partner._trackPageview'#{@ga_pageview_url ? ", '" + @ga_pageview_url + "'" : ""}], ['partner._trackPageLoadTime']);
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>
    <% else %>
      <%# THIS IS LOCAL TESTNG JAVASCRIPT FOR DUMPING GA TO THE CONSOLE %>
      <script type="text/javascript">
        if (window.console) {
          var _gaq = {push: function() { for (var c=0;c<arguments.length;c++) { console.log( "GA tracking:", arguments[c]) }}};
          _gaq.push(['_setAccount', 'UA-3965813-35'], ['_setDomainName', '.#{site.root_domain}'], ['_setAllowLinker', true], ['_trackPageview'#{@ga_pageview_url ? ", '" + @ga_pageview_url + "'" : ""}], ['_trackPageLoadTime']);
          _gaq.push(['blended._setAccount', 'UA-3965813-33'], ['blended._setDomainName', 'none'], ['blended._trackPageview'#{@ga_pageview_url ? ", '" + @ga_pageview_url + "'" : ""}], ['blended._trackPageLoadTime']);
          _gaq.push(['partner._setAccount', '#{site.ga_code}'], ['partner._setDomainName', '.#{site.root_domain}'], ['partner._setAllowLinker', true], ['partner._trackPageview'#{@ga_pageview_url ? ", '" + @ga_pageview_url + "'" : ""}], ['partner._trackPageLoadTime']);
        }
      </script>
    <% end %>
  </body>
</html>
